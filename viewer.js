/*!
 * Copyright (c) 2023 Jakub Cerveny, jakub.cerveny@gmail.com
 *
 */(()=>{"use strict";function t(t){return t*Math.PI/180}class i{constructor(t,i,e,s=-1,r=undefined){let n="";s>=0&&(n=`#version ${s} es\n`),r&&(n+=r),this.t=t,this.i=this.h(t.VERTEX_SHADER,i,n),this.o=this.h(t.FRAGMENT_SHADER,e,n),this.l=this.u(this.i,this.o),this.v=new Map,this.p=new Map}m(){this.t.useProgram(this.l)}A(t){let i=this.p.get(t);return void 0!==i||(i=this.t.getUniformLocation(this.l,t),null===i&&console.warn(`Uniform ${t} not found.`),this.p.set(t,i)),i}_(t){let i=this.v.get(t);return void 0!==i||(i=this.t.getAttribLocation(this.l,t),null===i&&console.warn(`Attribute ${t} not found.`),this.v.set(t,i)),i}h(t,i,e){let s=this.t,r=s.createShader(t);if(s.shaderSource(r,e?e+i:i),s.compileShader(r),!s.getShaderParameter(r,s.COMPILE_STATUS))throw new Error("Error compiling "+(t==s.VERTEX_SHADER?"vertex":"fragment")+` shader: ${s.getShaderInfoLog(r)}`);return r}u(t,i){let e=this.t,s=e.createProgram();if(e.attachShader(s,t),e.attachShader(s,i),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error("Error linking program:"+e.getProgramInfoLog(s));return s}delete(){this.t.deleteProgram(this.l),this.t.deleteShader(this.i),this.t.deleteShader(this.o),this.l=null,this.i=null,this.o=null}}class e{constructor(t,i,e){this.t=t,this.width=i,this.height=e,this.g=[],this.k=[],this.M=t.createFramebuffer(),this.bind()}D(t,i,e){let s=this.t,r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r),s.texImage2D(s.TEXTURE_2D,0,i,this.width,this.height,0,i,e,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.framebufferTexture2D(s.FRAMEBUFFER,t,s.TEXTURE_2D,r,0),this.g.push(r)}I(t,i){let e=this.t,s=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,s),e.renderbufferStorage(e.RENDERBUFFER,i,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,s),this.k.push(s)}C(){let t=this.t,i=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i!=t.FRAMEBUFFER_COMPLETE)throw new Error(`Error creating framebuffer: status ${i}`);this.R()}bind(){this.t.bindFramebuffer(this.t.FRAMEBUFFER,this.M)}R(){this.t.bindFramebuffer(this.t.FRAMEBUFFER,null)}delete(){this.R();for(const t of this.k)this.t.deleteRenderbuffer(t);for(const t of this.g)this.t.deleteTexture(t);this.t.deleteFramebuffer(this.M),this.M=null,this.g=null,this.k=null}}var s=null;function r(t,i="",e=5e3){let r=document.getElementById("error-message");r.innerHTML=t,r.className="show "+i,s&&clearTimeout(s),s=setTimeout((()=>{let t=document.getElementById("error-message");t.innerHTML="",t.className="",s=null}),e),console[i.length?"error":"log"](t)}let n=Float32Array;function h(t,i,e){const s=new n(3);return t&&(s[0]=t),i&&(s[1]=i),e&&(s[2]=e),s}function o(t,i,e){return(e=e||new n(3))[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function a(t,i,e){return(e=e||new n(3))[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function l(t,i,e){return(e=e||new n(3))[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function f(t,i,e){e=e||new n(3);const s=t[2]*i[0]-t[0]*i[2],r=t[0]*i[1]-t[1]*i[0];return e[0]=t[1]*i[2]-t[2]*i[1],e[1]=s,e[2]=r,e}function c(t,i){i=i||new n(3);const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.sqrt(e);return s>1e-5?(i[0]=t[0]/s,i[1]=t[1]/s,i[2]=t[2]/s):(i[0]=0,i[1]=0,i[2]=0),i}function u(t,i){return(i=i||new n(3))[0]=t[0],i[1]=t[1],i[2]=t[2],i}function d(t,i){return(i=i||new n(3))[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i}class v{constructor(t){this.F=h(),this.B=-90,this.U=30,this.zoom=9.5,this.eye=h(),this.L=h(),this.right=h(),this.Z(),this.J=.2,this.G={F:h(),B:this.B,U:this.U,zoom:this.zoom},this.N=null,this.T=null,this.S=!1,this.O=0,this.P=Math.min(window.devicePixelRatio,2),this.H=-1e5,t.addEventListener("pointerdown",this.j.bind(this)),document.addEventListener("pointerup",this.K.bind(this)),t.addEventListener("pointermove",this.V.bind(this)),t.addEventListener("wheel",this.$.bind(this)),t.addEventListener("contextmenu",this.contextMenu.bind(this)),this.Y=function(t,i){},this.onupdate=function(){},this.W=performance.now()}update(t){let i=t-this.W;this.W=t,i>300&&(i=16);const e=.001;if(function(t,i){const e=t[0]-i[0],s=t[1]-i[1],r=t[2]-i[2];return e*e+s*s+r*r}(this.F,this.G.F)>e*e||Math.abs(this.B-this.G.B)>e||Math.abs(this.U-this.G.U)>e||Math.abs(this.zoom-this.G.zoom)>e*e){let t=1-Math.pow(1-this.J,i/16),e=this.S?t/2:t;return s=this.F,r=this.G.F,h=e,(o=(o=this.F)||new n(3))[0]=s[0]+h*(r[0]-s[0]),o[1]=s[1]+h*(r[1]-s[1]),o[2]=s[2]+h*(r[2]-s[2]),this.B+=t*(this.G.B-this.B),this.U+=t*(this.G.U-this.U),this.zoom=Math.log2(Math.pow(2,this.zoom)+e*(Math.pow(2,this.G.zoom)-Math.pow(2,this.zoom))),this.Z(),!0}var s,r,h,o;return!1}X(t){u(t,this.F),u(t,this.G.F),this.Z()}q(t,i,e){this.B=this.G.B=t,this.U=this.G.U=i,this.zoom=this.G.zoom=e,this.Z()}Z(){let i=Math.cos(t(this.B)),e=Math.sin(t(this.B)),s=Math.cos(t(this.U)),r=Math.sin(t(this.U)),n=Math.pow(2,this.zoom);this.eye[0]=this.F[0]+i*s*n,this.eye[1]=this.F[1]+e*s*n,this.eye[2]=this.F[2]+r*n,this.L[0]=-i*r,this.L[1]=-e*r,this.L[2]=s,this.right[0]=-e,this.right[1]=i,this.right[2]=0}tt(){return c(a(this.F,this.eye))}it(){let t=Array.from(this.right),i=Array.from(this.L),e=Array.from(this.tt());return t.concat(i).concat(e)}pan(t,i){const e=75e-5*Math.pow(2,this.G.zoom)*this.P;this.G.F[0]+=e*(-t*this.right[0]+i*this.L[0]),this.G.F[1]+=e*(-t*this.right[1]+i*this.L[1]),this.G.F[2]+=e*(-t*this.right[2]+i*this.L[2]),this.S=!1}rotate(t,i){const e=.2*this.P;this.G.B-=t*e,this.G.U+=i*e,this.G.U=Math.min(Math.max(this.G.U,-90),90),this.H<0&&(this.H=performance.now())}et(){return Math.hypot(this.N.st-this.T.st,this.N.rt-this.T.rt)}j(t){this.N?this.T||(this.T=t,this.T.st=t.clientX,this.T.rt=t.clientY,this.T.nt=.5*(this.N.st+this.T.st),this.T.ht=.5*(this.N.rt+this.T.rt),this.T.ot=this.et(),this.T.lt=this.G.zoom):(this.N=t,this.N.st=t.clientX,this.N.rt=t.clientY),t.target.setPointerCapture(t.pointerId),t.preventDefault()}V(t){if(this.N&&!this.T){let i=t.clientX-this.N.st,e=t.clientY-this.N.rt;0==this.N.button?this.rotate(i,e):this.pan(i,e),this.N.st=t.clientX,this.N.rt=t.clientY,this.onupdate()}else if(this.N&&this.T){let i=t.pointerId==this.N.pointerId?this.N:t.pointerId==this.T.pointerId?this.T:null;if(i){i.st=t.clientX,i.rt=t.clientY;let e=.5*(this.N.st+this.T.st),s=.5*(this.N.rt+this.T.rt),r=e-this.T.nt,n=s-this.T.ht;this.pan(r,n),this.T.nt=e,this.T.ht=s;let h=this.et();this.G.zoom=this.T.lt+Math.log2(this.T.ot/h),this.onupdate()}}t.preventDefault()}K(t){if(this.N&&!this.T&&0==this.N.button){if(Math.hypot(t.clientX-this.N.clientX,t.clientY-this.N.clientY)<8&&performance.now()-this.N.timeStamp<300){if(performance.now()-this.O<300)this.G.zoom-=1,this.S=!1,this.O=0;else{let s=this.Y(t.clientX,t.clientY);if(s){this.G.F=s;let t=c(a(this.F,this.eye)),r=(i=a(this.G.F,this.eye),e=t,i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),n=a(this.G.F,l(t,r));this.G.zoom=Math.log2(function(t,i){const e=t[0]-i[0],s=t[1]-i[1],r=t[2]-i[2];return Math.sqrt(e*e+s*s+r*r)}(n,this.G.F)),this.S=!0,this.O=this.H=performance.now()}}this.onupdate()}}var i,e;this.N&&t.pointerId==this.N.pointerId?(this.N=this.T,this.T=null):this.T&&t.pointerId==this.T.pointerId&&(this.T=null)}$(t){this.G.zoom+=.003*t.deltaY,this.G.zoom=Math.min(Math.max(this.G.zoom,-10),24),this.onupdate(),t.preventDefault()}contextMenu(t){t.preventDefault()}}let w,p,m,b=Float32Array;function A(t){return(t=t||new b(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _(t,i){i=i||new b(16);const e=t[0],s=t[1],r=t[2],n=t[3],h=t[4],o=t[5],a=t[6],l=t[7],f=t[8],c=t[9],u=t[10],d=t[11],v=t[12],w=t[13],p=t[14],m=t[15],A=u*m,_=p*d,y=a*m,E=p*l,g=a*d,k=u*l,M=r*m,D=p*n,I=r*d,C=u*n,x=r*l,R=a*n,F=f*w,z=v*c,B=h*w,U=v*o,L=h*c,Z=f*o,J=e*w,G=v*s,N=e*c,T=f*s,S=e*o,O=h*s,P=A*o+E*c+g*w-(_*o+y*c+k*w),H=_*s+M*c+C*w-(A*s+D*c+I*w),j=y*s+D*o+x*w-(E*s+M*o+R*w),K=k*s+I*o+R*c-(g*s+C*o+x*c),V=1/(e*P+h*H+f*j+v*K);return i[0]=V*P,i[1]=V*H,i[2]=V*j,i[3]=V*K,i[4]=V*(_*h+y*f+k*v-(A*h+E*f+g*v)),i[5]=V*(A*e+D*f+I*v-(_*e+M*f+C*v)),i[6]=V*(E*e+M*h+R*v-(y*e+D*h+x*v)),i[7]=V*(g*e+C*h+x*f-(k*e+I*h+R*f)),i[8]=V*(F*l+U*d+L*m-(z*l+B*d+Z*m)),i[9]=V*(z*n+J*d+T*m-(F*n+G*d+N*m)),i[10]=V*(B*n+G*l+S*m-(U*n+J*l+O*m)),i[11]=V*(Z*n+N*l+O*d-(L*n+T*l+S*d)),i[12]=V*(B*u+Z*p+z*a-(L*p+F*a+U*u)),i[13]=V*(N*p+F*r+G*u-(J*u+T*p+z*r)),i[14]=V*(J*a+O*p+U*r-(S*p+B*r+G*a)),i[15]=V*(S*u+L*r+T*a-(N*a+O*u+Z*r)),i}function y(t,i,e,s){return s=s||new b(16),w=w||h(),p=p||h(),m=m||h(),c(a(t,i,m),m),c(f(e,m,w),w),c(f(m,w,p),p),s[0]=w[0],s[1]=w[1],s[2]=w[2],s[3]=0,s[4]=p[0],s[5]=p[1],s[6]=p[2],s[7]=0,s[8]=m[0],s[9]=m[1],s[10]=m[2],s[11]=0,s[12]=t[0],s[13]=t[1],s[14]=t[2],s[15]=1,s}function E(t,i,e){e=e||h();const s=i[0],r=i[1],n=i[2],o=s*t[3]+r*t[7]+n*t[11]+t[15];return e[0]=(s*t[0]+r*t[4]+n*t[8]+t[12])/o,e[1]=(s*t[1]+r*t[5]+n*t[9]+t[13])/o,e[2]=(s*t[2]+r*t[6]+n*t[10]+t[14])/o,e}!function(t){const i=n;n=t}(Float64Array),function(t){const i=b;b=t}(Float64Array);class g{constructor(){this.ft=-1,this.ct=0,this.near=0,this.ut=0,this.eye=h(),this.F=h(),this.L=h(),this.dt=A(),this.vt=A(),this.wt=A(),this.bt=A(),this.At=A(),this._t=[[0,0,1,1],[0,0,-1,1],[1,0,0,1],[-1,0,0,1],[0,1,0,1],[0,-1,0,1]],this.yt=new Array(6);for(let t=0;t<6;t++)this.yt[t]=[0,0,0,0];this.Et=A(),this.gt=new Array(8);for(let t=0;t<8;t++)this.gt[t]=[0,0,0];this.kt=h(0,0,0),this.Mt=h()}Dt(i,e,s,r){this.ft=i,this.ct=e,this.near=s,this.ut=r,function(t,i,e,s,r){r=r||new b(16);const n=Math.tan(.5*Math.PI-.5*t),h=1/(e-s);r[0]=n/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=(e+s)*h,r[11]=-1,r[12]=0,r[13]=0,r[14]=e*s*h*2,r[15]=0}(t(i),e,s,r,this.dt)}It(t,i,e){if(this.ft<0)throw new Error("Camera.setView: setProjection must be called first.");u(t,this.eye),u(i,this.F),u(e,this.L),a(this.eye,this.F,this.Mt),y(this.Mt,this.kt,this.L,this.bt),_(this.bt,this.wt),y(this.eye,this.F,this.L,this.bt),_(this.bt,this.vt),function(t,i,e){e=e||new b(16);const s=t[0],r=t[1],n=t[2],h=t[3],o=t[4],a=t[5],l=t[6],f=t[7],c=t[8],u=t[9],d=t[10],v=t[11],w=t[12],p=t[13],m=t[14],A=t[15],_=i[0],y=i[1],E=i[2],g=i[3],k=i[4],M=i[5],D=i[6],I=i[7],C=i[8],x=i[9],R=i[10],F=i[11],z=i[12],B=i[13],U=i[14],L=i[15];e[0]=s*_+o*y+c*E+w*g,e[1]=r*_+a*y+u*E+p*g,e[2]=n*_+l*y+d*E+m*g,e[3]=h*_+f*y+v*E+A*g,e[4]=s*k+o*M+c*D+w*I,e[5]=r*k+a*M+u*D+p*I,e[6]=n*k+l*M+d*D+m*I,e[7]=h*k+f*M+v*D+A*I,e[8]=s*C+o*x+c*R+w*F,e[9]=r*C+a*x+u*R+p*F,e[10]=n*C+l*x+d*R+m*F,e[11]=h*C+f*x+v*R+A*F,e[12]=s*z+o*B+c*U+w*L,e[13]=r*z+a*B+u*U+p*L,e[14]=n*z+l*B+d*U+m*L,e[15]=h*z+f*B+v*U+A*L}(this.dt,this.vt,this.At),function(t,i){if((i=i||new b(16))===t){let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,i}const e=t[0],s=t[1],r=t[2],n=t[3],h=t[4],o=t[5],a=t[6],l=t[7],f=t[8],c=t[9],u=t[10],d=t[11],v=t[12],w=t[13],p=t[14],m=t[15];i[0]=e,i[1]=h,i[2]=f,i[3]=v,i[4]=s,i[5]=o,i[6]=c,i[7]=w,i[8]=r,i[9]=a,i[10]=u,i[11]=p,i[12]=n,i[13]=l,i[14]=d,i[15]=m}(this.At,this.Et);for(let t=0;t<6;t++)k(this.Et,this._t[t],this.yt[t])}Ct(t,i,e,s){return s=s||h(),E(this.At,t,s),s[0]=i*(s[0]+1)/2,s[1]=e*(s[1]+1)/2,s}xt(t,i,e,s,r,n){let h=2*t/s-1,o=2*i/r-1;return this.Mt[0]=e*h/this.dt[0],this.Mt[1]=e*o/this.dt[5],this.Mt[2]=-e,E(this.bt,this.Mt,n)}Rt(t){let i=this.gt;i[0][0]=t[0][0],i[0][1]=t[0][1],i[0][2]=t[0][2],i[1][0]=t[1][0],i[1][1]=t[0][1],i[1][2]=t[0][2],i[2][0]=t[0][0],i[2][1]=t[1][1],i[2][2]=t[0][2],i[3][0]=t[1][0],i[3][1]=t[1][1],i[3][2]=t[0][2],i[4][0]=t[0][0],i[4][1]=t[0][1],i[4][2]=t[1][2],i[5][0]=t[1][0],i[5][1]=t[0][1],i[5][2]=t[1][2],i[6][0]=t[0][0],i[6][1]=t[1][1],i[6][2]=t[1][2],i[7][0]=t[1][0],i[7][1]=t[1][1],i[7][2]=t[1][2];for(let t=0;t<6;t++){let e=!0;for(let s=0;s<8;s++){if(i[s][0]*this.yt[t][0]+i[s][1]*this.yt[t][1]+i[s][2]*this.yt[t][2]+this.yt[t][3]>=0){e=!1;break}}if(e)return!1}return!0}Ft(t){let i=this.vt,e=t,s=i[2]*e[0]+i[6]*e[1]+i[10]*e[2]+i[14],r=Math.max(-s,this.near);return this.dt[0]/r}}function k(t,i,e){const s=i[0],r=i[1],n=i[2],h=i[3];return e[0]=s*t[0]+r*t[4]+n*t[8]+h*t[12],e[1]=s*t[1]+r*t[5]+n*t[9]+h*t[13],e[2]=s*t[2]+r*t[6]+n*t[10]+h*t[14],e[3]=s*t[3]+r*t[7]+n*t[11]+h*t[15],e}var M=(t,i,e,s)=>{let r=65535&t|0,n=t>>>16&65535|0,h=0;for(;0!==e;){h=e>2e3?2e3:e,e-=h;do{r=r+i[s++]|0,n=n+r|0}while(--h);r%=65521,n%=65521}return r|n<<16|0};const D=new Uint32Array((()=>{let t,i=[];for(var e=0;e<256;e++){t=e;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;i[e]=t}return i})());var I=(t,i,e,s)=>{const r=D,n=s+e;t^=-1;for(let e=s;e<n;e++)t=t>>>8^r[255&(t^i[e])];return-1^t};const C=16209;var x=function(t,i){let e,s,r,n,h,o,a,l,f,c,u,d,v,w,p,m,b,A,_,y,E,g,k,M;const D=t.state;e=t.zt,k=t.input,s=e+(t.Bt-5),r=t.Ut,M=t.Lt,n=r-(i-t.Zt),h=r+(t.Zt-257),o=D.Jt,a=D.Gt,l=D.Nt,f=D.Tt,c=D.window,u=D.St,d=D.Ot,v=D.Pt,w=D.Ht,p=(1<<D.jt)-1,m=(1<<D.Kt)-1;t:do{d<15&&(u+=k[e++]<<d,d+=8,u+=k[e++]<<d,d+=8),b=v[u&p];i:for(;;){if(A=b>>>24,u>>>=A,d-=A,A=b>>>16&255,0===A)M[r++]=65535&b;else{if(!(16&A)){if(0==(64&A)){b=v[(65535&b)+(u&(1<<A)-1)];continue i}if(32&A){D.mode=16191;break t}t.Vt="invalid literal/length code",D.mode=C;break t}_=65535&b,A&=15,A&&(d<A&&(u+=k[e++]<<d,d+=8),_+=u&(1<<A)-1,u>>>=A,d-=A),d<15&&(u+=k[e++]<<d,d+=8,u+=k[e++]<<d,d+=8),b=w[u&m];e:for(;;){if(A=b>>>24,u>>>=A,d-=A,A=b>>>16&255,!(16&A)){if(0==(64&A)){b=w[(65535&b)+(u&(1<<A)-1)];continue e}t.Vt="invalid distance code",D.mode=C;break t}if(y=65535&b,A&=15,d<A&&(u+=k[e++]<<d,d+=8,d<A&&(u+=k[e++]<<d,d+=8)),y+=u&(1<<A)-1,y>o){t.Vt="invalid distance too far back",D.mode=C;break t}if(u>>>=A,d-=A,A=r-n,y>A){if(A=y-A,A>l&&D.$t){t.Vt="invalid distance too far back",D.mode=C;break t}if(E=0,g=c,0===f){if(E+=a-A,A<_){_-=A;do{M[r++]=c[E++]}while(--A);E=r-y,g=M}}else if(f<A){if(E+=a+f-A,A-=f,A<_){_-=A;do{M[r++]=c[E++]}while(--A);if(E=0,f<_){A=f,_-=A;do{M[r++]=c[E++]}while(--A);E=r-y,g=M}}}else if(E+=f-A,A<_){_-=A;do{M[r++]=c[E++]}while(--A);E=r-y,g=M}for(;_>2;)M[r++]=g[E++],M[r++]=g[E++],M[r++]=g[E++],_-=3;_&&(M[r++]=g[E++],_>1&&(M[r++]=g[E++]))}else{E=r-y;do{M[r++]=M[E++],M[r++]=M[E++],M[r++]=M[E++],_-=3}while(_>2);_&&(M[r++]=M[E++],_>1&&(M[r++]=M[E++]))}break}}break}}while(e<s&&r<h);_=d>>3,e-=_,d-=_<<3,u&=(1<<d)-1,t.zt=e,t.Ut=r,t.Bt=e<s?s-e+5:5-(e-s),t.Zt=r<h?h-r+257:257-(r-h),D.St=u,D.Ot=d};const R=15,F=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),B=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),U=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var L=(t,i,e,s,r,n,h,o)=>{const a=o.Ot;let l,f,c,u,d,v,w=0,p=0,m=0,b=0,A=0,_=0,y=0,E=0,g=0,k=0,M=null;const D=new Uint16Array(16),I=new Uint16Array(16);let C,x,L,Z=null;for(w=0;w<=R;w++)D[w]=0;for(p=0;p<s;p++)D[i[e+p]]++;for(A=a,b=R;b>=1&&0===D[b];b--);if(A>b&&(A=b),0===b)return r[n++]=20971520,r[n++]=20971520,o.Ot=1,0;for(m=1;m<b&&0===D[m];m++);for(A<m&&(A=m),E=1,w=1;w<=R;w++)if(E<<=1,E-=D[w],E<0)return-1;if(E>0&&(0===t||1!==b))return-1;for(I[1]=0,w=1;w<R;w++)I[w+1]=I[w]+D[w];for(p=0;p<s;p++)0!==i[e+p]&&(h[I[i[e+p]]++]=p);if(0===t?(M=Z=h,v=20):1===t?(M=F,Z=z,v=257):(M=B,Z=U,v=0),k=0,p=0,w=m,d=n,_=A,y=0,c=-1,g=1<<A,u=g-1,1===t&&g>852||2===t&&g>592)return 1;for(;;){C=w-y,h[p]+1<v?(x=0,L=h[p]):h[p]>=v?(x=Z[h[p]-v],L=M[h[p]-v]):(x=96,L=0),l=1<<w-y,f=1<<_,m=f;do{f-=l,r[d+(k>>y)+f]=C<<24|x<<16|L|0}while(0!==f);for(l=1<<w-1;k&l;)l>>=1;if(0!==l?(k&=l-1,k+=l):k=0,p++,0==--D[w]){if(w===b)break;w=i[e+h[p]]}if(w>A&&(k&u)!==c){for(0===y&&(y=A),d+=m,_=w-y,E=1<<_;_+y<b&&(E-=D[_+y],!(E<=0));)_++,E<<=1;if(g+=1<<_,1===t&&g>852||2===t&&g>592)return 1;c=k&u,r[c]=A<<24|_<<16|d-n|0}}return 0!==k&&(r[d+k]=w-y<<24|64<<16|0),o.Ot=A,0},Z={Qt:0,Yt:1,Wt:2,Xt:3,qt:4,ti:5,ii:6,ei:0,si:1,ri:2,ni:-1,hi:-2,oi:-3,ai:-4,li:-5,fi:0,ci:1,ui:9,di:-1,vi:1,wi:2,pi:3,mi:4,bi:0,Ai:0,_i:1,yi:2,Ei:8};const{qt:J,ti:G,ii:N,ei:T,si:S,ri:O,hi:P,oi:H,ai:j,li:K,Ei:V}=Z,$=16180,Q=16190,Y=16191,W=16192,X=16194,q=16199,tt=16200,it=16206,et=16209,st=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function rt(){this.gi=null,this.mode=0,this.ki=!1,this.wrap=0,this.Mi=!1,this.flags=0,this.Jt=0,this.check=0,this.total=0,this.head=null,this.Di=0,this.Gt=0,this.Nt=0,this.Tt=0,this.window=null,this.St=0,this.Ot=0,this.length=0,this.offset=0,this.Ii=0,this.Pt=null,this.Ht=null,this.jt=0,this.Kt=0,this.Ci=0,this.xi=0,this.Ri=0,this.Fi=0,this.next=null,this.zi=new Uint16Array(320),this.Bi=new Uint16Array(288),this.Ui=null,this.Li=null,this.$t=0,this.back=0,this.Zi=0}const nt=t=>{if(!t)return 1;const i=t.state;return!i||i.gi!==t||i.mode<$||i.mode>16211?1:0},ht=t=>{if(nt(t))return P;const i=t.state;return t.Ji=t.Gi=i.total=0,t.Vt="",i.wrap&&(t.Ni=1&i.wrap),i.mode=$,i.ki=0,i.Mi=0,i.flags=-1,i.Jt=32768,i.head=null,i.St=0,i.Ot=0,i.Pt=i.Ui=new Int32Array(852),i.Ht=i.Li=new Int32Array(592),i.$t=1,i.back=-1,T},ot=t=>{if(nt(t))return P;const i=t.state;return i.Gt=0,i.Nt=0,i.Tt=0,ht(t)},at=(t,i)=>{let e;if(nt(t))return P;const s=t.state;return i<0?(e=0,i=-i):(e=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?P:(null!==s.window&&s.Di!==i&&(s.window=null),s.wrap=e,s.Di=i,ot(t))},lt=(t,i)=>{if(!t)return P;const e=new rt;t.state=e,e.gi=t,e.window=null,e.mode=$;const s=at(t,i);return s!==T&&(t.state=null),s};let ft,ct,ut=!0;const dt=t=>{if(ut){ft=new Int32Array(512),ct=new Int32Array(32);let i=0;for(;i<144;)t.zi[i++]=8;for(;i<256;)t.zi[i++]=9;for(;i<280;)t.zi[i++]=7;for(;i<288;)t.zi[i++]=8;for(L(1,t.zi,0,288,ft,0,t.Bi,{Ot:9}),i=0;i<32;)t.zi[i++]=5;L(2,t.zi,0,32,ct,0,t.Bi,{Ot:5}),ut=!1}t.Pt=ft,t.jt=9,t.Ht=ct,t.Kt=5},vt=(t,i,e,s)=>{let r;const n=t.state;return null===n.window&&(n.Gt=1<<n.Di,n.Tt=0,n.Nt=0,n.window=new Uint8Array(n.Gt)),s>=n.Gt?(n.window.set(i.subarray(e-n.Gt,e),0),n.Tt=0,n.Nt=n.Gt):(r=n.Gt-n.Tt,r>s&&(r=s),n.window.set(i.subarray(e-s,e-s+r),n.Tt),(s-=r)?(n.window.set(i.subarray(e-s,e),0),n.Tt=s,n.Nt=n.Gt):(n.Tt+=r,n.Tt===n.Gt&&(n.Tt=0),n.Nt<n.Gt&&(n.Nt+=r))),0};var wt=(t,i)=>{let e,s,r,n,h,o,a,l,f,c,u,d,v,w,p,m,b,A,_,y,E,g,k=0;const D=new Uint8Array(4);let C,R;const F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(nt(t)||!t.Lt||!t.input&&0!==t.Bt)return P;e=t.state,e.mode===Y&&(e.mode=W),h=t.Ut,r=t.Lt,a=t.Zt,n=t.zt,s=t.input,o=t.Bt,l=e.St,f=e.Ot,c=o,u=a,g=T;t:for(;;)switch(e.mode){case $:if(0===e.wrap){e.mode=W;break}for(;f<16;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(2&e.wrap&&35615===l){0===e.Di&&(e.Di=15),e.check=0,D[0]=255&l,D[1]=l>>>8&255,e.check=I(e.check,D,2,0),l=0,f=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&l)<<8)+(l>>8))%31){t.Vt="incorrect header check",e.mode=et;break}if((15&l)!==V){t.Vt="unknown compression method",e.mode=et;break}if(l>>>=4,f-=4,E=8+(15&l),0===e.Di&&(e.Di=E),E>15||E>e.Di){t.Vt="invalid window size",e.mode=et;break}e.Jt=1<<e.Di,e.flags=0,t.Ni=e.check=1,e.mode=512&l?16189:Y,l=0,f=0;break;case 16181:for(;f<16;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(e.flags=l,(255&e.flags)!==V){t.Vt="unknown compression method",e.mode=et;break}if(57344&e.flags){t.Vt="unknown header flags set",e.mode=et;break}e.head&&(e.head.text=l>>8&1),512&e.flags&&4&e.wrap&&(D[0]=255&l,D[1]=l>>>8&255,e.check=I(e.check,D,2,0)),l=0,f=0,e.mode=16182;case 16182:for(;f<32;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}e.head&&(e.head.time=l),512&e.flags&&4&e.wrap&&(D[0]=255&l,D[1]=l>>>8&255,D[2]=l>>>16&255,D[3]=l>>>24&255,e.check=I(e.check,D,4,0)),l=0,f=0,e.mode=16183;case 16183:for(;f<16;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}e.head&&(e.head.Ti=255&l,e.head.Si=l>>8),512&e.flags&&4&e.wrap&&(D[0]=255&l,D[1]=l>>>8&255,e.check=I(e.check,D,2,0)),l=0,f=0,e.mode=16184;case 16184:if(1024&e.flags){for(;f<16;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}e.length=l,e.head&&(e.head.Oi=l),512&e.flags&&4&e.wrap&&(D[0]=255&l,D[1]=l>>>8&255,e.check=I(e.check,D,2,0)),l=0,f=0}else e.head&&(e.head.Ii=null);e.mode=16185;case 16185:if(1024&e.flags&&(d=e.length,d>o&&(d=o),d&&(e.head&&(E=e.head.Oi-e.length,e.head.Ii||(e.head.Ii=new Uint8Array(e.head.Oi)),e.head.Ii.set(s.subarray(n,n+d),E)),512&e.flags&&4&e.wrap&&(e.check=I(e.check,s,d,n)),o-=d,n+=d,e.length-=d),e.length))break t;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(0===o)break t;d=0;do{E=s[n+d++],e.head&&E&&e.length<65536&&(e.head.name+=String.fromCharCode(E))}while(E&&d<o);if(512&e.flags&&4&e.wrap&&(e.check=I(e.check,s,d,n)),o-=d,n+=d,E)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(0===o)break t;d=0;do{E=s[n+d++],e.head&&E&&e.length<65536&&(e.head.Pi+=String.fromCharCode(E))}while(E&&d<o);if(512&e.flags&&4&e.wrap&&(e.check=I(e.check,s,d,n)),o-=d,n+=d,E)break t}else e.head&&(e.head.Pi=null);e.mode=16188;case 16188:if(512&e.flags){for(;f<16;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(4&e.wrap&&l!==(65535&e.check)){t.Vt="header crc mismatch",e.mode=et;break}l=0,f=0}e.head&&(e.head.Hi=e.flags>>9&1,e.head.done=!0),t.Ni=e.check=0,e.mode=Y;break;case 16189:for(;f<32;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}t.Ni=e.check=st(l),l=0,f=0,e.mode=Q;case Q:if(0===e.Mi)return t.Ut=h,t.Zt=a,t.zt=n,t.Bt=o,e.St=l,e.Ot=f,O;t.Ni=e.check=1,e.mode=Y;case Y:if(i===G||i===N)break t;case W:if(e.ki){l>>>=7&f,f-=7&f,e.mode=it;break}for(;f<3;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}switch(e.ki=1&l,l>>>=1,f-=1,3&l){case 0:e.mode=16193;break;case 1:if(dt(e),e.mode=q,i===N){l>>>=2,f-=2;break t}break;case 2:e.mode=16196;break;case 3:t.Vt="invalid block type",e.mode=et}l>>>=2,f-=2;break;case 16193:for(l>>>=7&f,f-=7&f;f<32;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if((65535&l)!=(l>>>16^65535)){t.Vt="invalid stored block lengths",e.mode=et;break}if(e.length=65535&l,l=0,f=0,e.mode=X,i===N)break t;case X:e.mode=16195;case 16195:if(d=e.length,d){if(d>o&&(d=o),d>a&&(d=a),0===d)break t;r.set(s.subarray(n,n+d),h),o-=d,n+=d,a-=d,h+=d,e.length-=d;break}e.mode=Y;break;case 16196:for(;f<14;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(e.xi=257+(31&l),l>>>=5,f-=5,e.Ri=1+(31&l),l>>>=5,f-=5,e.Ci=4+(15&l),l>>>=4,f-=4,e.xi>286||e.Ri>30){t.Vt="too many length or distance symbols",e.mode=et;break}e.Fi=0,e.mode=16197;case 16197:for(;e.Fi<e.Ci;){for(;f<3;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}e.zi[F[e.Fi++]]=7&l,l>>>=3,f-=3}for(;e.Fi<19;)e.zi[F[e.Fi++]]=0;if(e.Pt=e.Ui,e.jt=7,C={Ot:e.jt},g=L(0,e.zi,0,19,e.Pt,0,e.Bi,C),e.jt=C.Ot,g){t.Vt="invalid code lengths set",e.mode=et;break}e.Fi=0,e.mode=16198;case 16198:for(;e.Fi<e.xi+e.Ri;){for(;k=e.Pt[l&(1<<e.jt)-1],p=k>>>24,m=k>>>16&255,b=65535&k,!(p<=f);){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(b<16)l>>>=p,f-=p,e.zi[e.Fi++]=b;else{if(16===b){for(R=p+2;f<R;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(l>>>=p,f-=p,0===e.Fi){t.Vt="invalid bit length repeat",e.mode=et;break}E=e.zi[e.Fi-1],d=3+(3&l),l>>>=2,f-=2}else if(17===b){for(R=p+3;f<R;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}l>>>=p,f-=p,E=0,d=3+(7&l),l>>>=3,f-=3}else{for(R=p+7;f<R;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}l>>>=p,f-=p,E=0,d=11+(127&l),l>>>=7,f-=7}if(e.Fi+d>e.xi+e.Ri){t.Vt="invalid bit length repeat",e.mode=et;break}for(;d--;)e.zi[e.Fi++]=E}}if(e.mode===et)break;if(0===e.zi[256]){t.Vt="invalid code -- missing end-of-block",e.mode=et;break}if(e.jt=9,C={Ot:e.jt},g=L(1,e.zi,0,e.xi,e.Pt,0,e.Bi,C),e.jt=C.Ot,g){t.Vt="invalid literal/lengths set",e.mode=et;break}if(e.Kt=6,e.Ht=e.Li,C={Ot:e.Kt},g=L(2,e.zi,e.xi,e.Ri,e.Ht,0,e.Bi,C),e.Kt=C.Ot,g){t.Vt="invalid distances set",e.mode=et;break}if(e.mode=q,i===N)break t;case q:e.mode=tt;case tt:if(o>=6&&a>=258){t.Ut=h,t.Zt=a,t.zt=n,t.Bt=o,e.St=l,e.Ot=f,x(t,u),h=t.Ut,r=t.Lt,a=t.Zt,n=t.zt,s=t.input,o=t.Bt,l=e.St,f=e.Ot,e.mode===Y&&(e.back=-1);break}for(e.back=0;k=e.Pt[l&(1<<e.jt)-1],p=k>>>24,m=k>>>16&255,b=65535&k,!(p<=f);){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(m&&0==(240&m)){for(A=p,_=m,y=b;k=e.Pt[y+((l&(1<<A+_)-1)>>A)],p=k>>>24,m=k>>>16&255,b=65535&k,!(A+p<=f);){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}l>>>=A,f-=A,e.back+=A}if(l>>>=p,f-=p,e.back+=p,e.length=b,0===m){e.mode=16205;break}if(32&m){e.back=-1,e.mode=Y;break}if(64&m){t.Vt="invalid literal/length code",e.mode=et;break}e.Ii=15&m,e.mode=16201;case 16201:if(e.Ii){for(R=e.Ii;f<R;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}e.length+=l&(1<<e.Ii)-1,l>>>=e.Ii,f-=e.Ii,e.back+=e.Ii}e.Zi=e.length,e.mode=16202;case 16202:for(;k=e.Ht[l&(1<<e.Kt)-1],p=k>>>24,m=k>>>16&255,b=65535&k,!(p<=f);){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(0==(240&m)){for(A=p,_=m,y=b;k=e.Ht[y+((l&(1<<A+_)-1)>>A)],p=k>>>24,m=k>>>16&255,b=65535&k,!(A+p<=f);){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}l>>>=A,f-=A,e.back+=A}if(l>>>=p,f-=p,e.back+=p,64&m){t.Vt="invalid distance code",e.mode=et;break}e.offset=b,e.Ii=15&m,e.mode=16203;case 16203:if(e.Ii){for(R=e.Ii;f<R;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}e.offset+=l&(1<<e.Ii)-1,l>>>=e.Ii,f-=e.Ii,e.back+=e.Ii}if(e.offset>e.Jt){t.Vt="invalid distance too far back",e.mode=et;break}e.mode=16204;case 16204:if(0===a)break t;if(d=u-a,e.offset>d){if(d=e.offset-d,d>e.Nt&&e.$t){t.Vt="invalid distance too far back",e.mode=et;break}d>e.Tt?(d-=e.Tt,v=e.Gt-d):v=e.Tt-d,d>e.length&&(d=e.length),w=e.window}else w=r,v=h-e.offset,d=e.length;d>a&&(d=a),a-=d,e.length-=d;do{r[h++]=w[v++]}while(--d);0===e.length&&(e.mode=tt);break;case 16205:if(0===a)break t;r[h++]=e.length,a--,e.mode=tt;break;case it:if(e.wrap){for(;f<32;){if(0===o)break t;o--,l|=s[n++]<<f,f+=8}if(u-=a,t.Gi+=u,e.total+=u,4&e.wrap&&u&&(t.Ni=e.check=e.flags?I(e.check,r,u,h-u):M(e.check,r,u,h-u)),u=a,4&e.wrap&&(e.flags?l:st(l))!==e.check){t.Vt="incorrect data check",e.mode=et;break}l=0,f=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;f<32;){if(0===o)break t;o--,l+=s[n++]<<f,f+=8}if(4&e.wrap&&l!==(4294967295&e.total)){t.Vt="incorrect length check",e.mode=et;break}l=0,f=0}e.mode=16208;case 16208:g=S;break t;case et:g=H;break t;case 16210:return j;default:return P}return t.Ut=h,t.Zt=a,t.zt=n,t.Bt=o,e.St=l,e.Ot=f,(e.Gt||u!==t.Zt&&e.mode<et&&(e.mode<it||i!==J))&&vt(t,t.Lt,t.Ut,u-t.Zt),c-=t.Bt,u-=t.Zt,t.Ji+=c,t.Gi+=u,e.total+=u,4&e.wrap&&u&&(t.Ni=e.check=e.flags?I(e.check,r,u,t.Ut-u):M(e.check,r,u,t.Ut-u)),t.ji=e.Ot+(e.ki?64:0)+(e.mode===Y?128:0)+(e.mode===q||e.mode===X?256:0),(0===c&&0===u||i===J)&&g===T&&(g=K),g},pt={Ki:ot,Vi:at,$i:ht,Qi:t=>lt(t,15),Yi:lt,Wi:wt,Xi:t=>{if(nt(t))return P;let i=t.state;return i.window&&(i.window=null),t.state=null,T},qi:(t,i)=>{if(nt(t))return P;const e=t.state;return 0==(2&e.wrap)?P:(e.head=i,i.done=!1,T)},te:(t,i)=>{const e=i.length;let s,r,n;return nt(t)?P:(s=t.state,0!==s.wrap&&s.mode!==Q?P:s.mode===Q&&(r=1,r=M(r,i,e,0),r!==s.check)?H:(n=vt(t,i,e,e),n?(s.mode=16210,j):(s.Mi=1,T)))},ie:"pako inflate (from Nodeca project)"};const mt=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);var bt={assign:function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const e=i.shift();if(e){if("object"!=typeof e)throw new TypeError(e+"must be non-object");for(const i in e)mt(e,i)&&(t[i]=e[i])}}return t},ee:t=>{let i=0;for(let e=0,s=t.length;e<s;e++)i+=t[e].length;const e=new Uint8Array(i);for(let i=0,s=0,r=t.length;i<r;i++){let r=t[i];e.set(r,s),s+=r.length}return e}};let At=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){At=!1}const _t=new Uint8Array(256);for(let t=0;t<256;t++)_t[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;_t[254]=_t[254]=1;var yt={se:t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let i,e,s,r,n,h=t.length,o=0;for(r=0;r<h;r++)e=t.charCodeAt(r),55296==(64512&e)&&r+1<h&&(s=t.charCodeAt(r+1),56320==(64512&s)&&(e=65536+(e-55296<<10)+(s-56320),r++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(i=new Uint8Array(o),n=0,r=0;n<o;r++)e=t.charCodeAt(r),55296==(64512&e)&&r+1<h&&(s=t.charCodeAt(r+1),56320==(64512&s)&&(e=65536+(e-55296<<10)+(s-56320),r++)),e<128?i[n++]=e:e<2048?(i[n++]=192|e>>>6,i[n++]=128|63&e):e<65536?(i[n++]=224|e>>>12,i[n++]=128|e>>>6&63,i[n++]=128|63&e):(i[n++]=240|e>>>18,i[n++]=128|e>>>12&63,i[n++]=128|e>>>6&63,i[n++]=128|63&e);return i},re:(t,i)=>{const e=i||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,i));let s,r;const n=new Array(2*e);for(r=0,s=0;s<e;){let i=t[s++];if(i<128){n[r++]=i;continue}let h=_t[i];if(h>4)n[r++]=65533,s+=h-1;else{for(i&=2===h?31:3===h?15:7;h>1&&s<e;)i=i<<6|63&t[s++],h--;h>1?n[r++]=65533:i<65536?n[r++]=i:(i-=65536,n[r++]=55296|i>>10&1023,n[r++]=56320|1023&i)}}return((t,i)=>{if(i<65534&&t.subarray&&At)return String.fromCharCode.apply(null,t.length===i?t:t.subarray(0,i));let e="";for(let s=0;s<i;s++)e+=String.fromCharCode(t[s]);return e})(n,r)},ne:(t,i)=>{(i=i||t.length)>t.length&&(i=t.length);let e=i-1;for(;e>=0&&128==(192&t[e]);)e--;return e<0||0===e?i:e+_t[t[e]]>i?e:i}},Et={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var gt=function(){this.input=null,this.zt=0,this.Bt=0,this.Ji=0,this.Lt=null,this.Ut=0,this.Zt=0,this.Gi=0,this.Vt="",this.state=null,this.ji=2,this.Ni=0};var kt=function(){this.text=0,this.time=0,this.Ti=0,this.Si=0,this.Ii=null,this.Oi=0,this.name="",this.Pi="",this.Hi=0,this.done=!1};const Mt=Object.prototype.toString,{Qt:Dt,qt:It,ei:Ct,si:xt,ri:Rt,hi:Ft,oi:zt,ai:Bt}=Z;function Ut(t){this.options=bt.assign({he:65536,oe:15,to:""},t||{});const i=this.options;i.raw&&i.oe>=0&&i.oe<16&&(i.oe=-i.oe,0===i.oe&&(i.oe=-15)),!(i.oe>=0&&i.oe<16)||t&&t.oe||(i.oe+=32),i.oe>15&&i.oe<48&&0==(15&i.oe)&&(i.oe|=15),this.ae=0,this.Vt="",this.ended=!1,this.le=[],this.gi=new gt,this.gi.Zt=0;let e=pt.Yi(this.gi,i.oe);if(e!==Ct)throw new Error(Et[e]);if(this.fe=new kt,pt.qi(this.gi,this.fe),i.ce&&("string"==typeof i.ce?i.ce=yt.se(i.ce):"[object ArrayBuffer]"===Mt.call(i.ce)&&(i.ce=new Uint8Array(i.ce)),i.raw&&(e=pt.te(this.gi,i.ce),e!==Ct)))throw new Error(Et[e])}function Lt(t,i){return(i=i||{}).raw=!0,function(t,i){const e=new Ut(i);if(e.push(t),e.ae)throw e.Vt||Et[e.ae];return e.result}(t,i)}Ut.prototype.push=function(t,i){const e=this.gi,s=this.options.he,r=this.options.ce;let n,h,o;if(this.ended)return!1;for(h=i===~~i?i:!0===i?It:Dt,"[object ArrayBuffer]"===Mt.call(t)?e.input=new Uint8Array(t):e.input=t,e.zt=0,e.Bt=e.input.length;;){for(0===e.Zt&&(e.Lt=new Uint8Array(s),e.Ut=0,e.Zt=s),n=pt.Wi(e,h),n===Rt&&r&&(n=pt.te(e,r),n===Ct?n=pt.Wi(e,h):n===zt&&(n=Rt));e.Bt>0&&n===xt&&e.state.wrap>0&&0!==t[e.zt];)pt.Ki(e),n=pt.Wi(e,h);switch(n){case Ft:case zt:case Rt:case Bt:return this.ue(n),this.ended=!0,!1}if(o=e.Zt,e.Ut&&(0===e.Zt||n===xt))if("string"===this.options.to){let t=yt.ne(e.Lt,e.Ut),i=e.Ut-t,r=yt.re(e.Lt,t);e.Ut=i,e.Zt=s-i,i&&e.Lt.set(e.Lt.subarray(t,t+i),0),this.de(r)}else this.de(e.Lt.length===e.Ut?e.Lt:e.Lt.subarray(0,e.Ut));if(n!==Ct||0!==o){if(n===xt)return n=pt.Xi(this.gi),this.ue(n),this.ended=!0,!0;if(0===e.Bt)break}}return!0},Ut.prototype.de=function(t){this.le.push(t)},Ut.prototype.ue=function(t){t===Ct&&("string"===this.options.to?this.result=this.le.join(""):this.result=bt.ee(this.le)),this.le=[],this.ae=t,this.Vt=this.gi.Vt};class Zt{constructor(t,i){let e;this.dataset=t,this.t=i,this.gsize=[1,1,1],this.ve={we:0,pe:0,me:i.createBuffer(),be:i.createBuffer()},this.volume=this.Ae(i.RGBA,i.RGBA,[0,0,0,0],i.LINEAR),this._e=this.Ae(i.RGBA,i.RGBA,[0,0,0,0],i.LINEAR),this.ye=this.Ae(i.R8,i.RED,[1],i.NEAREST),this.Ee=null,this.ge=[],this.ke=[],this.Me=[],this.ncd=0,this.nca=0,this.De=0,this.Ie=[[null,null,null],[null,null,null]],this.Ce=[[null,null,null],[null,null,null]],this.lines=[[null,null,null],[null,null,null],[null]],this.xe=document.getElementsByClassName("progress-wrap")[0],this.Re=document.getElementsByClassName("progress-bytes")[0],this.Fe=document.getElementsByClassName("progress-value")[0],this.ze=0,this.Be=1e10,this.Ue=this.Le().then((()=>{e=Date.now(),this.Ze(),this.Je()})).then((()=>{this.Ge()})).catch((t=>{r(t,"error")}))}Ne(t){this.ze+=t;let i=Math.min(100*this.ze/this.Be,100);this.Fe.style.width=`${i.toFixed(1)}%`,this.Re.innerText=i<100?`${(this.ze/(1<<20)).toFixed(1)} MB`:"Decoding..."}Ge(){this.xe.style.visibility="hidden"}Le(){this.Te=this.Se("meta.json");let t=[this.Te,this.Oe("map.bin"),this.Pe("mesh.bin"),this.He("dp0.bin",0,0),this.He("dp1.bin",0,1),this.He("dp2.bin",0,2),this.He("ap0.bin",1,0),this.He("ap1.bin",1,1),this.He("ap2.bin",1,2),this.je("dl0.bin",0,0),this.je("dl1.bin",0,1),this.je("dl2.bin",0,2),this.je("al0.bin",1,0),this.je("al1.bin",1,1),this.je("al2.bin",1,2),this.je("bm.bin",2,0)];return Promise.all(t)}async Ke(t){let i=await fetch(this.dataset+"/"+t);if(!i.ok)throw new Error(i.statusText);let e=i.body.getReader(),s=[],r=0;for(;;){let{done:t,value:i}=await e.read();if(t)break;s.push(i),r+=i.length,this.Ne(i.length)}let n=new Uint8Array(r),h=0;for(let t of s)n.set(t,h),h+=t.length;return n.buffer}Se(t){return this.Ke(t).then((t=>{var i=(new TextDecoder).decode(new Uint8Array(t)),e=JSON.parse(i);if(this.gsize=e.size,this.ncd=e.ncd,this.nca=e.nca,this.De=e.ds,this.Ve=e.eval_mode,this.Me=e.frange,this.Be=e.total_bytes,"mlp"!=this.Ve)throw new Error("Unknown eval mode.");this.ge=[e.mlp_weight0,e.mlp_weight1,e.mlp_weight2],this.ke=[e.mlp_bias0,e.mlp_bias1,e.mlp_bias2]}))}Pe(t){return this.Ke(t).then((t=>{let i=this.t,e=Lt(new Uint8Array(t)),s=new Uint32Array(e.buffer,0,2);this.ve.we=s[0],this.ve.pe=s[1];let r=3*this.ve.we;i.bindBuffer(i.ARRAY_BUFFER,this.ve.me),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e.buffer,8,r),i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.ve.be),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint32Array(e.buffer,8+4*r),i.STATIC_DRAW)}))}Oe(t){return this.Ke(t).then((t=>{let i=Lt(new Uint8Array(t)),e=new Uint32Array(i.buffer,0,5);if(1397577300!=e[0]||1!=e[1])throw new Error("Corrupt data file");let s=e[2],r=e[3],n=e[4],h=new Uint8Array(i.buffer,20),o=this.t;o.bindTexture(o.TEXTURE_3D,this.ye),o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.texImage3D(o.TEXTURE_3D,0,o.R8,s,r,n,0,o.RED,o.UNSIGNED_BYTE,h),this.Ee={size:[s,r,n],map:h}}))}He(t,i,e){return this.Ke(t).then((t=>{let s=new Uint32Array(t,0,5);if(1347245652!=s[0]||1!=s[1])throw new Error("Corrupt data file");let r=s[2],n=s[3],h=s[4],o=new Uint32Array(t,20,h),a=new Float32Array(t,4*(5+h),2*h),l=this.t,f=l.createTexture();l.bindTexture(l.TEXTURE_3D,f),l.texImage3D(l.TEXTURE_3D,0,l.R8,r,n,h,0,l.RED,l.UNSIGNED_BYTE,null),this.$e(l.TEXTURE_3D,l.NEAREST);let c=[],u=4*(5+3*h);for(let i=0;i<h;i++){let e=new Blob([t.slice(u,u+o[i])],{type:"image/jpeg"});u+=o[i];let s=new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=URL.createObjectURL(e)})).then((t=>{l.bindTexture(l.TEXTURE_3D,f),l.pixelStorei(l.UNPACK_ALIGNMENT,1),l.texSubImage3D(l.TEXTURE_3D,0,0,0,i,r,n,1,l.RED,l.UNSIGNED_BYTE,t)}));c.push(s)}return this.Ie[i][e]=f,this.Ce[i][e]=a,Promise.all(c)}))}je(t,i,e){return this.Ke(t).then((t=>{let s=new Uint32Array(t,0,5);if(1145919060!=s[0]||1!=s[1])throw new Error("Corrupt data file");let r=s[2],n=s[3],h=new Float32Array(t,16,r*n),o=this.t,a=o.createTexture();o.bindTexture(o.TEXTURE_2D,a),o.texImage2D(o.TEXTURE_2D,0,o.R32F,n,r,0,o.RED,o.FLOAT,h),this.$e(o.TEXTURE_2D,o.NEAREST),this.lines[i][e]=a}))}Ze(){let t=this.t,e=`#define NCD ${this.ncd}\n#define NCA ${this.nca}\n`,s=new i(t,"precision highp float;in vec2 a_pos;void main(){gl_Position=vec4(a_pos,0.,1.);}","precision highp float;uniform highp vec3 dps[NCD],dpo[NCD];uniform highp vec3 aps[NCA],apo[NCA];uniform lowp sampler3D dp0,dp1,dp2;uniform highp sampler2D dl0,dl1,dl2;uniform lowp sampler3D ap0,ap1,ap2;uniform highp sampler2D al0,al1,al2;uniform highp sampler2D bm;uniform lowp sampler3D map;uniform vec3 inv_gs;uniform int z;uniform float ds;uniform vec4 fscale[2];layout(location=0)out vec4 A;layout(location=1)out vec4 B;float C(float D){return(D>=0.)?D:0.;}\n#define E  texelFetch\nfloat F(int D,int G,int z){float H=0.;for(int I=0;I<NCD;I++){H+=(E(dp0,ivec3(D,G,I),0).r*dps[I].x+dpo[I].x)*E(dl0,ivec2(z,I),0).r+(E(dp1,ivec3(D,z,I),0).r*dps[I].y+dpo[I].y)*E(dl1,ivec2(G,I),0).r+(E(dp2,ivec3(G,z,I),0).r*dps[I].z+dpo[I].z)*E(dl2,ivec2(D,I),0).r;}return C(H+ds);}vec3 J(int K,int I){int L=K*NCA+I;return vec3(E(bm,ivec2(L,0),0).r,E(bm,ivec2(L,1),0).r,E(bm,ivec2(L,2),0).r);}vec4 M(int K,int I){int L=K*NCA+I;return vec4(E(bm,ivec2(L,3),0).r,E(bm,ivec2(L,4),0).r,E(bm,ivec2(L,5),0).r,E(bm,ivec2(L,6),0).r);}vec3 N(int D,int G,int z,out vec4 O){vec3 P=vec3(0.);vec4 Q=vec4(0.);for(int I=0;I<NCA;I++){float R=(E(ap0,ivec3(D,G,I),0).r*aps[I].x+apo[I].x)*E(al0,ivec2(z,I),0).r;float S=(E(ap1,ivec3(D,z,I),0).r*aps[I].y+apo[I].y)*E(al1,ivec2(G,I),0).r;float T=(E(ap2,ivec3(G,z,I),0).r*aps[I].z+apo[I].z)*E(al2,ivec2(D,I),0).r;P+=R*J(0,I)+S*J(1,I)+T*J(2,I);Q+=R*M(0,I)+S*M(1,I)+T*M(2,I);}O=Q;return P;}float U(int D,int G,int z){vec3 V=vec3(float(D),float(G),float(z));float W=texture(map,(V+vec3(0.5))*inv_gs).r;return round(W*255.);}const float X=0.12;void main(){int D=int(gl_FragCoord.x);int G=int(gl_FragCoord.y);if(U(D,G,z)>2.1){discard;return;}float Y=1.-exp(-F(D,G,z)*X);vec4 Q;vec3 P=N(D,G,z,Q);A=vec4(P,Y);B=fscale[0]*(Q+fscale[1]);}",300,e);s.m();let r=window.config.allow4Bit;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_3D,this.volume),t.texImage3D(t.TEXTURE_3D,0,r[0]?t.RGBA4:t.RGBA,this.gsize[0],this.gsize[1],this.gsize[2],0,t.RGBA,t.UNSIGNED_BYTE,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_3D,this._e),t.texImage3D(t.TEXTURE_3D,0,r[1]?t.RGBA4:t.RGBA,this.gsize[0],this.gsize[1],this.gsize[2],0,t.RGBA,t.UNSIGNED_BYTE,null);let n=2;for(let i=0;i<2;i++)for(let e=0;e<3;e++)t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_3D,this.Ie[i][e]),t.uniform1i(s.A(i?`ap${e}`:`dp${e}`),n++),t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,this.lines[i][e]),t.uniform1i(s.A(i?`al${e}`:`dl${e}`),n++);t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,this.lines[2][0]),t.uniform1i(s.A("bm"),n++),t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_3D,this.ye),t.uniform1i(s.A("map"),n++);for(let i=0;i<2;i++){let e=[],r=[],n=i?this.nca:this.ncd;for(let t=0;t<n;t++)for(let s=0;s<3;s++){let n=this.Ce[i][s][2*t+0],h=this.Ce[i][s][2*t+1];e.push(h-n),r.push(n)}t.uniform3fv(s.A(i?"aps":"dps"),e),t.uniform3fv(s.A(i?"apo":"dpo"),r)}let h=new Float32Array(8);for(let t=0;t<4;t++){let i=this.Me[t+3];h[t]=1/(i[1]-i[0]),h[t+4]=-i[0]}t.uniform4fv(s.A("fscale"),h),t.disable(t.DEPTH_TEST),t.viewport(0,0,this.gsize[0],this.gsize[1]);let o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]);let a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,1,-1,-3,3,1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(s._("a_pos"),2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s._("a_pos")),t.uniform1f(s.A("ds"),this.De),t.uniform3fv(s.A("inv_gs"),d(this.gsize));for(let i=0;i<this.gsize[2];i++)t.framebufferTextureLayer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,this.volume,0,i),t.framebufferTextureLayer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT1,this._e,0,i),t.uniform1i(s.A("z"),i),t.drawArrays(t.TRIANGLES,0,3);t.disableVertexAttribArray(s._("a_pos")),t.deleteBuffer(a),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(o)}Je(){let t=this.t;for(let i=0;i<2;i++)for(let e=0;e<3;e++)t.deleteTexture(this.Ie[i][e]),t.deleteTexture(this.lines[i][e]);t.deleteTexture(this.lines[2][0])}Ae(t,i,e,s){let r=this.t,n=r.createTexture();return r.bindTexture(r.TEXTURE_3D,n),r.texImage3D(r.TEXTURE_3D,0,t,1,1,1,0,i,r.UNSIGNED_BYTE,new Uint8Array(e)),this.$e(r.TEXTURE_3D,s),n}$e(t,i){let e=this.t;e.texParameteri(t,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_MIN_FILTER,i),e.texParameteri(t,e.TEXTURE_MAG_FILTER,i)}}class Jt{constructor(t,e){this.size=e,this.color=[1,1,1,1],this.t=t,this.l=new i(t,"precision highp float;attribute vec2 a_pos;uniform mat4 view,proj;uniform vec3 point;uniform float size;uniform vec2 iwh;varying vec2 v_pos;void main(){vec4 A=proj*(view*vec4(point,1.));vec2 B=A.xy/A.w;gl_Position=vec4(B+a_pos*iwh*size,0.,1.);v_pos=a_pos;}","precision mediump float;uniform vec4 color;varying vec2 v_pos;const float A=0.94;const float B=0.97;const float C=0.03;void main(){float D=length(v_pos);float E=1.;if(D<A){E=smoothstep(A-C,A,D);}else if(D>B){E=smoothstep(B+C,B,D);}gl_FragColor=vec4(color.rgb,E*color.a);}"),this.Qe=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.Qe),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),t.STATIC_DRAW)}Ye(t,i){if(!this.color[3])return;let e=this.t,s=this.l;e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),s.m(),e.uniformMatrix4fv(s.A("view"),!1,t.wt),e.uniformMatrix4fv(s.A("proj"),!1,t.dt),e.uniform3f(s.A("point"),i[0]-t.F[0],i[1]-t.F[1],i[2]-t.F[2]),e.uniform1f(s.A("size"),this.size/2),e.uniform4fv(s.A("color"),this.color),e.uniform2f(s.A("iwh"),2/e.canvas.width,2/e.canvas.height),e.bindBuffer(e.ARRAY_BUFFER,this.Qe),e.vertexAttribPointer(s._("a_pos"),2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s._("a_pos")),e.drawArrays(e.TRIANGLES,0,6),e.disableVertexAttribArray(s._("a_pos")),e.disable(e.BLEND)}}class Gt{constructor(t,i,e,s){this.popup=-1,this.diffuse=!0,this.specular=!0,this.filter=!0,this.fullscreen=!1,this.gsize=[0,0,0],this.totalVoxels=0,this.downloadSize=0,this.We=new Vue({el:"#"+i,data:this,methods:{popClick:function(t){this.popup=this.popup!=t?t:-1},popClass:function(t){return{down:this.popup==t,disabled:this.popup!=t&&-1!=this.popup}},fsEnabled:function(){return!!document.fullscreenEnabled},fsToggle:function(){null==document.fullscreenElement?document.body.requestFullscreen():document.exitFullscreen()}},watch:{diffuse:function(){t.update()},specular:function(){t.update()},filter:function(){t.update()}}}),s.Te.then((()=>{let t=s.gsize;this.gsize=t,this.totalVoxels=(t[0]*t[1]*t[2]/1e6).toFixed(1),this.downloadSize=function(t,i=2){if(0===t)return"0 Bytes";const e=i<0?0:i,s=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,s)).toFixed(e))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][s]}(s.Be)})),document.addEventListener("fullscreenchange",(t=>{this.fullscreen=null!=document.fullscreenElement})),e.addEventListener("pointerdown",(t=>{this.popup>=0&&(this.popup=-1,t.stopImmediatePropagation())}))}Xe(){this.popup=-1}}class Nt{constructor(){this.ft=50,this.near=1,this.ut=5e3,this.qe=0,this.P=window.devicePixelRatio,console.log(`devicePixelRatio = ${this.P}`),this.canvas=document.getElementById("nervv-canvas"),this.t=this.ts(this.canvas),this.es=new Zt(window.config.data,this.t),this.ss=new g,this.rs=new Gt(this,"nervv-ui",this.canvas,this.es),this.controls=new v(this.canvas),this.controls.onupdate=this.update.bind(this),this.controls.Y=this.xt.bind(this),this.es.Te.then((()=>{this.ns()})).catch((t=>{r(t,"error",15e3)})),this.es.Ue.then((()=>{let t=window.config.initPos;t&&6==t.length?(this.controls.X([t[0],t[1],t[2]]),this.controls.q(t[3],t[4],t[5])):this.controls.X(l(this.es.gsize,.5)),this.update()})),this.hs=new Jt(this.t,80),this.os=!1,this.update()}ns(){let t=this.t,e=`#define EVAL_MLP ${this.es.ls?0:1}\n#define EVAL_SG ${this.es.ls?1:0}\n`;this.fs=new i(t,"precision highp float;in vec2 a_pos;void main(){gl_Position=vec4(a_pos,0.,1.);}","precision highp float;uniform vec2 half_res;uniform vec2 inv_res;uniform float focal;uniform mat3 camera;uniform vec3 eye;uniform bool inside;uniform vec3 gs,inv_gs;uniform float far;uniform vec4 fscale[2];uniform bool mode[4];\n#define A  lowp\nuniform lowp sampler3D volume;uniform lowp sampler3D feat;uniform lowp sampler3D map;uniform lowp sampler2D surface;\n#if EVAL_MLP\n#define MLP_N  12\nuniform vec4 weight0[MLP_N*9];uniform vec4 weight1[MLP_N*4],bias1[4];uniform vec4 weight2[3*4],bias2;\n#endif\nout vec4 fragColor;A float B(A float C){return max(C,0.);}A float D(A float C){return 1./(1.+exp(-C));}\n#if EVAL_MLP\nvec3 evaluate_MLP_12_4(A vec3 E,A vec4 F,A vec3 G){A vec4 H[9];H[0]=vec4(E,F.x);H[1]=vec4(F.yzw,G.x);H[2]=vec4(G.yz,sin(G.x),sin(2.*G.x));H[3]=vec4(sin(4.*G.x),sin(8.*G.x),sin(G.y),sin(2.*G.y));H[4]=vec4(sin(4.*G.y),sin(8.*G.y),sin(G.z),sin(2.*G.z));H[5]=vec4(sin(4.*G.z),sin(8.*G.z),cos(G.x),cos(2.*G.x));H[6]=vec4(cos(4.*G.x),cos(8.*G.x),cos(G.y),cos(2.*G.y));H[7]=vec4(cos(4.*G.y),cos(8.*G.y),cos(G.z),cos(2.*G.z));H[8]=vec4(cos(4.*G.z),cos(8.*G.z),1.,0.);\n#define I(J,K)dot(weight0[J+K],H[K])\n#define L(J)(I(J,0)+I(J,1)+I(J,2)+I(J,3)+I(J,4)+I(J,5)+I(J,6)+I(J,7)+I(J,8))\nA vec4 M[3];for(int J=0;J<3;J++){M[J]=vec4(B(L((J*4+0)*9)),B(L((J*4+1)*9)),B(L((J*4+2)*9)),B(L((J*4+3)*9)));}\n#define N(J,K)dot(weight1[J+K],M[K])\n#define O(J)(N(J,0)+N(J,1)+N(J,2))\nA vec4 P[3];for(int J=0;J<3;J++){P[J]=vec4(B(O((J*4+0)*3)+bias1[J].x),B(O((J*4+1)*3)+bias1[J].y),B(O((J*4+2)*3)+bias1[J].z),B(O((J*4+3)*3)+bias1[J].w));}\n#define Q(J,K)dot(weight2[J+K],P[K])\n#define R(J)(Q(J,0)+Q(J,1)+Q(J,2))\nreturn vec3(D(R(0)+bias2.x),D(R(3)+bias2.y),D(R(6)+bias2.z));}\n#if MLP_N == 16\n#define S  evaluate_MLP_16_4\n#elif MLP_N == 12\n#define S  evaluate_MLP_12_4\n#endif\n#endif \nvec2 T(vec3 U,vec3 V,vec3 W,vec3 X){vec3 Y=(U-W)*X;vec3 Z=(V-W)*X;vec3 a=min(Y,Z);vec3 b=max(Y,Z);return vec2(max(a.x,max(a.y,a.z)),min(b.x,min(b.y,b.z)));}vec4 c(vec3 d,vec3 e){return texture(volume,d*e);}vec4 f(vec3 d,vec3 e){return texture(feat,d*e);}float g(vec3 d,vec3 e){float h=texture(map,d*e).r;return round(h*255.);}float i(vec3 j){return dot(j,vec3(1.,1./256.,1./(256.*256.)));}void main(){highp vec2 k=gl_FragCoord.xy-half_res;vec3 l=normalize(camera*vec3(k,focal));vec3 m=1./l;vec2 n=T(vec3(0.),gs,eye,m);vec3 E=vec3(0.);vec4 F=vec4(0.);lowp float o=1.;vec2 p=gl_FragCoord.xy*inv_res;vec3 q=texture(surface,p).rgb;float r=i(q)*far;float s=max(max(n.x+0.25,inside?0.:r),0.);int t=0,u=0;int v=int(max(gs.x,max(gs.y,gs.z)));float w=0.01;float x=s;if(mode[2]){float y=5./focal;while(s<n.y&&o>w&&t<v){vec3 z=eye+s*l;float h=g(z,inv_gs);if(h<2.1){lowp float AA=clamp(s*y,0.3,1.);vec4 AB=c(z,inv_gs);vec4 feat=f(z,inv_gs);u++;lowp float AC=AB.a;if(AA<1.){AC=1.-pow(1.-AC,AA);}if(mode[0]){E+=o*AC*AB.rgb;}F+=o*AC*feat;o*=1.-AC;s+=AA;}else{s+=h;}t++;}}else{w=0.01;while(s<n.y&&o>w&&t<v){vec3 z=eye+s*l;float h=g(z,inv_gs);if(h<2.1){vec3 AD=(step(0.,l)-fract(z))*m;s+=min(AD.x,min(AD.y,AD.z))+0.001;float AA=s-x;z+=AA/2.*l;vec4 AB=c(z,inv_gs);vec4 feat=f(z,inv_gs);u++;lowp float AC=AB.a;AC=1.-pow(1.-AC,AA);if(mode[0]){E+=o*AC*AB.rgb;}F+=o*AC*feat;o*=1.-AC;}else{s+=h;}x=s;t++;}}const vec3 AE=vec3(1.,1.,1.);if(o==1.){fragColor=vec4(AE,1.);return;}float AF=1./(1.-o);F*=AF;if(o>w){E+=o*AE;}else{E*=AF;}\n#if 0\nif(u>=40){fragColor=vec4(1.,0.,0.,0.5);return;}if(t>=100){fragColor=vec4(1.,0.,1.,1.);return;}\n#endif\nvec4 feat=F*fscale[0]+fscale[1];if(mode[1]){\n#if EVAL_MLP\nE+=S(E,feat,l);\n#endif\n}else if(!mode[0]){E=F.xyw;if(o>w){E+=o*AE;}}fragColor=vec4(E,1.);if(mode[3])fragColor=vec4(q,1.);}",300,e),this.cs=new i(t,"precision highp float;uniform mat4 view,proj;in vec3 a_pos;out float v_dist;void main(){vec4 A=vec4(a_pos,1.);vec4 B=view*A;v_dist=length(B.xyz);gl_Position=proj*B;}","precision highp float;uniform float inv_far;in float v_dist;out vec4 fragColor;vec3 A(float B){vec3 C=vec3(1.,256.,256.*256.)*B;C=fract(C);C-=C.yzz*vec3(1./256.,1./256.,0.);return C;}void main(){highp float D=v_dist*inv_far;fragColor=vec4(A(D),1.);}",300,e)}us(t){this.t;this.os=!1;let i=this.vs(),e=this.controls.update(t);this.ss.Dt(this.ft,i,this.near,this.ut),this.ss.It(this.controls.eye,this.controls.F,this.controls.L),this.ws(),this.M.bind(),this.ps(i),this.M.R(),this.bs(),e|=this.As(),e&&this.update()}_s(){return this.t.canvas.height/2/Math.tan(t(this.ft)/2)}bs(){let t=this.t,i=this.fs;if(!i)return t.clearColor(1,1,1,1),void t.clear(t.COLOR_BUFFER_BIT);let e=t.canvas.width,s=t.canvas.height;t.disable(t.DEPTH_TEST),i.m(),t.uniform2f(i.A("half_res"),e/2,s/2),t.uniform1f(i.A("focal"),this._s()),t.uniformMatrix3fv(i.A("camera"),!1,this.controls.it()),t.uniform3fv(i.A("eye"),this.controls.eye),t.uniform1i(i.A("inside"),this.ys(this.controls.eye)),t.uniform3fv(i.A("gs"),this.es.gsize),t.uniform3fv(i.A("inv_gs"),d(this.es.gsize)),t.uniform2f(i.A("inv_res"),1/e,1/s),t.uniform1f(i.A("far"),this.ut),t.uniform1fv(i.A("mode"),[this.rs.diffuse,this.rs.specular,this.rs.filter,this.qe]),this.Es(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_3D,this.es.volume),t.uniform1i(i.A("volume"),0);let r=this.rs.filter?t.LINEAR:t.NEAREST;t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAG_FILTER,r),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_3D,this.es._e),t.uniform1i(i.A("feat"),1),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAG_FILTER,r),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_3D,this.es.ye),t.uniform1i(i.A("map"),2),t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,this.M.g[0]),t.uniform1i(i.A("surface"),3),t.bindBuffer(t.ARRAY_BUFFER,this.Qe),t.vertexAttribPointer(i._("a_pos"),2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i._("a_pos")),t.drawArrays(t.TRIANGLES,0,3),t.disableVertexAttribArray(i._("a_pos"))}Es(){let t=this.t,i=this.fs;if("mlp"==this.es.Ve)for(let e=0;e<this.es.ge.length;e++){let s=this.es.ge[e],r=s.length,n=s[0].length,h=4*Math.ceil(n/4),o=new Float32Array(r*h);for(let t=0;t<r;t++)o.set(s[t],t*h),0==e&&(o[t*h+n]=this.es.ke[e][t]);if(t.uniform4fv(i.A(`weight${e}`),o),e>0){let s=this.es.ke[e],r=new Float32Array(4*Math.ceil(s.length/4));r.set(s),t.uniform4fv(i.A(`bias${e}`),r)}}let e=new Float32Array(8);for(let t=0;t<4;t++){let i=this.es.Me[t+3];e[t]=i[1]-i[0],e[t+4]=i[0]}t.uniform4fv(i.A("fscale"),e)}ys(t){let i=this.es.Ee;if(!i)return!1;let e=function(t,i,e){return Math.floor(Math.min(Math.max(t/i,0),.999)*e)},s=e(t[0],this.es.gsize[0],i.size[0]),r=e(t[1],this.es.gsize[1],i.size[1]),n=e(t[2],this.es.gsize[2],i.size[2]);return i.map[(n*i.size[1]+r)*i.size[0]+s]<2.01+this.near}ws(){let t=this.t;!this.M||this.M.width==t.canvas.width&&this.M.height==t.canvas.height||(this.M.delete(),this.M=null),this.M||(this.M=new e(t,t.canvas.width,t.canvas.height),this.M.D(t.COLOR_ATTACHMENT0,t.RGBA,t.UNSIGNED_BYTE),this.M.I(t.DEPTH_ATTACHMENT,t.DEPTH_COMPONENT16),this.M.C())}ps(t){let i=this.t,e=this.cs,s=this.es.ve;e&&(i.clearColor(1,1,1,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.DEPTH_TEST),i.enable(i.CULL_FACE),e.m(),i.uniformMatrix4fv(e.A("view"),!1,this.ss.vt),i.uniformMatrix4fv(e.A("proj"),!1,this.ss.dt),i.uniform1f(e.A("inv_far"),1/this.ut),i.bindBuffer(i.ARRAY_BUFFER,s.me),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,s.be),i.vertexAttribPointer(e._("a_pos"),3,i.FLOAT,!1,0,0),i.enableVertexAttribArray(e._("a_pos")),i.drawElements(i.TRIANGLES,3*s.pe,i.UNSIGNED_INT,0),i.disableVertexAttribArray(e._("a_pos")))}update(){this.os||(requestAnimationFrame(this.us.bind(this)),this.os=!0)}vs(){let t=this.t,i=Math.round(1*t.canvas.clientWidth),e=Math.round(1*t.canvas.clientHeight);return t.canvas.width==i&&t.canvas.height==e||(t.canvas.width=i,t.canvas.height=e),t.viewport(0,0,i,e),i/e}gs(t,i){let e=l(this.controls.right,t-this.t.canvas.width/2),s=l(this.controls.L,i-this.t.canvas.height/2),r=l(this.controls.tt(),this._s());return c(o(o(e,s),r))}xt(t,i){let{cx:e,cy:s}=function(t,i,e){let s,r=t.getBoundingClientRect(),n=t.width/t.height,h=0,o=0;return n<r.width/r.height?(s=t.height/r.height,h=(r.width-r.height*n)/2):(s=t.width/r.width,o=(r.height-r.width/n)/2),{cx:(i-r.left-h)*s,cy:(e-r.top-o)*s}}(this.canvas,t,i),r=e,n=this.M.height-1-s;this.M.bind();let h=this.t,a=new Uint8Array(4);h.readPixels(r,n,1,1,h.RGBA,h.UNSIGNED_BYTE,a),this.M.R();let f=this.ks(a[0],a[1],a[2]);if(f<.99){let t=l(this.gs(r,n),f*this.ut);return o(this.controls.eye,t)}}ks(t,i,e){return t*(1/256)+i*(1/65536)+e*(1/16777216)}As(){let t=performance.now()-this.controls.H,i=Math.min(Math.max(4-t/300,0),1);return i&&(this.hs.color[3]=i,this.hs.Ye(this.ss,this.controls.G.F)),i>0}ts(t){let i=t.getContext("webgl2",{antialias:!1,alpha:!1});if(!i)throw new Error("WebGL2 not supported.");return this.Qe=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.Qe),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,1,-1,-3,3,1]),i.STATIC_DRAW),window.addEventListener("resize",this.update.bind(this)),i}}let Tt=null;window.addEventListener("load",(function(){try{Tt=new Nt}catch(t){r(t,"error",15e3)}}))})();